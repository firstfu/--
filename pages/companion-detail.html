<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>夥伴詳情 - 山伴</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body class="bg-gray-100 min-h-screen">
    <!-- 導航欄 -->
    <nav class="bg-white shadow-md py-4">
      <div class="container mx-auto px-4 flex justify-between items-center">
        <a href="../index.html" class="text-2xl font-bold text-primary">山伴</a>

        <!-- 桌面導航選項 -->
        <div class="hidden md:flex space-x-6">
          <a href="../index.html" class="nav-link">首頁</a>
          <a href="companions.html" class="nav-link active">找夥伴</a>
          <a href="create-request.html" class="nav-link">發布需求</a>
          <a href="about.html" class="nav-link">關於我們</a>
        </div>

        <!-- 登入/註冊按鈕 -->
        <div class="hidden md:flex space-x-4">
          <a href="login.html" class="px-4 py-2 rounded border border-primary text-primary hover:bg-primary hover:text-white transition">登入</a>
          <a href="register.html" class="px-4 py-2 rounded bg-primary text-white hover:bg-primary-dark transition">註冊</a>
        </div>

        <!-- 移動設備選單按鈕 -->
        <button id="mobile-menu-button" class="md:hidden text-gray-500 focus:outline-none">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>
      </div>

      <!-- 移動設備選單 -->
      <div id="mobile-menu" class="md:hidden hidden bg-white shadow-md absolute left-0 right-0 z-10">
        <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
          <a href="../index.html" class="nav-link">首頁</a>
          <a href="companions.html" class="nav-link active">找夥伴</a>
          <a href="create-request.html" class="nav-link">發布需求</a>
          <a href="about.html" class="nav-link">關於我們</a>
          <div class="pt-3 border-t border-gray-200 flex space-x-4">
            <a href="login.html" class="px-4 py-2 rounded border border-primary text-primary hover:bg-primary hover:text-white transition">登入</a>
            <a href="register.html" class="px-4 py-2 rounded bg-primary text-white hover:bg-primary-dark transition">註冊</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- 頁面內容 -->
    <div class="container mx-auto px-4 py-8">
      <a href="companions.html" class="inline-flex items-center text-primary hover:text-primary-dark mb-6">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        返回夥伴列表
      </a>

      <div id="companion-details" class="bg-white rounded-lg shadow-md overflow-hidden">
        <!-- 夥伴資訊將由JavaScript動態載入 -->
        <div class="animate-pulse">
          <div class="bg-gray-200 h-64 w-full"></div>
          <div class="p-6 space-y-4">
            <div class="h-8 bg-gray-200 rounded w-1/3"></div>
            <div class="h-4 bg-gray-200 rounded w-1/2"></div>
            <div class="h-4 bg-gray-200 rounded w-full"></div>
            <div class="h-4 bg-gray-200 rounded w-full"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 頁腳 -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-xl font-bold mb-4">山伴</h3>
            <p class="text-gray-300">連接熱愛登山的人們，讓每一次登山都有最佳體驗。</p>
          </div>
          <div>
            <h4 class="font-bold mb-4">快速連結</h4>
            <ul class="space-y-2">
              <li><a href="../index.html" class="text-gray-300 hover:text-white">首頁</a></li>
              <li><a href="companions.html" class="text-gray-300 hover:text-white">找夥伴</a></li>
              <li><a href="create-request.html" class="text-gray-300 hover:text-white">發布需求</a></li>
              <li><a href="about.html" class="text-gray-300 hover:text-white">關於我們</a></li>
            </ul>
          </div>
          <div>
            <h4 class="font-bold mb-4">資源</h4>
            <ul class="space-y-2">
              <li><a href="#" class="text-gray-300 hover:text-white">登山安全指南</a></li>
              <li><a href="#" class="text-gray-300 hover:text-white">裝備清單</a></li>
              <li><a href="#" class="text-gray-300 hover:text-white">常見問題</a></li>
              <li><a href="#" class="text-gray-300 hover:text-white">使用條款</a></li>
            </ul>
          </div>
          <div>
            <h4 class="font-bold mb-4">聯絡我們</h4>
            <ul class="space-y-2">
              <li class="flex items-center">
                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  ></path>
                </svg>
                info@shanban.com
              </li>
              <li class="flex items-center">
                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                  ></path>
                </svg>
                (02) 1234-5678
              </li>
            </ul>
          </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-300">
          <p>&copy; 2023 山伴. 保留所有權利.</p>
        </div>
      </div>
    </footer>

    <script src="../js/app.js"></script>
    <script>
      // 初始化頁面
      document.addEventListener("DOMContentLoaded", () => {
        // 移動選單切換
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");

        if (mobileMenuButton && mobileMenu) {
          mobileMenuButton.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
          });
        }

        // 從URL獲取夥伴ID
        const urlParams = new URLSearchParams(window.location.search);
        const companionId = urlParams.get("id");

        if (!companionId) {
          document.getElementById("companion-details").innerHTML = `
            <div class="p-8 text-center">
              <h2 class="text-2xl font-bold text-red-600 mb-3">找不到夥伴資料</h2>
              <p class="text-gray-600">無法找到指定的夥伴資料，請返回夥伴列表重新選擇。</p>
            </div>
          `;
          return;
        }

        // 模擬從API獲取夥伴資料
        fetchCompanionDetails(companionId);
      });

      // 模擬獲取夥伴資料的函數
      function fetchCompanionDetails(id) {
        // 模擬不同夥伴的數據
        const mockCompanions = {
          1: {
            id: 1,
            name: "林志明",
            type: "專業嚮導",
            rating: 5.0,
            ratingCount: 48,
            imageUrl: "https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
            specialty: "北部山區、高海拔路線",
            experience: "8年登山經驗，嚮導證照",
            languages: "中文、英文、台語",
            price: 2500,
            bio: "專業登山嚮導，擁有多項證照，曾帶領超過200次高山攀登活動。熟悉台灣各大山脈路線，特別專精於北部山區和高海拔路線。注重安全，有豐富的緊急應變經驗。",
            availableDates: ["2023-12-10", "2023-12-17", "2023-12-24"],
            reviews: [
              { name: "張小明", rating: 5, comment: "非常專業的嚮導，讓我第一次攀登玉山就充滿信心！" },
              { name: "李大方", rating: 5, comment: "安全意識很高，裝備齊全，解說詳盡，非常推薦！" },
            ],
          },
          2: {
            id: 2,
            name: "陳美玲",
            type: "進階愛好者",
            rating: 4.8,
            ratingCount: 32,
            imageUrl: "https://images.unsplash.com/photo-1540539234-c14a20fb7c7b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
            specialty: "中級山、健行步道",
            experience: "5年登山經驗",
            languages: "中文、英文",
            price: 1800,
            bio: "熱愛大自然，擅長中級山路線和健行步道。除了登山外，也是攝影愛好者，可以為您拍攝美麗的山景照片。熟悉台灣中部山區，對植物有一定了解，能分享山林知識。",
            availableDates: ["2023-12-03", "2023-12-16", "2023-12-23"],
            reviews: [
              { name: "王小華", rating: 5, comment: "美玲非常親切，帶我們走了很多隱藏版的美景點！" },
              { name: "陳大明", rating: 4, comment: "很好的體驗，拍了很多美照，下次還會找她！" },
            ],
          },
          3: {
            id: 3,
            name: "王小明",
            type: "風趣伙伴",
            rating: 4.5,
            ratingCount: 25,
            imageUrl: "https://images.unsplash.com/photo-1565992441121-4367c2967103?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
            specialty: "郊山步道、市郊健行",
            experience: "3年登山經驗",
            languages: "中文、台語",
            price: 1200,
            bio: "健談幽默的登山夥伴，善於活躍氣氛，讓登山過程充滿歡樂。擅長台北近郊的山徑，特別是適合初學者的路線。同時也是美食愛好者，了解各地山產和特色小吃。",
            availableDates: ["2023-12-02", "2023-12-09", "2023-12-30"],
            reviews: [
              { name: "林小芳", rating: 4, comment: "很風趣的夥伴，一路上笑聲不斷，還推薦了很棒的小吃！" },
              { name: "張建國", rating: 5, comment: "非常適合第一次爬山的人，讓整個過程變得輕鬆愉快。" },
            ],
          },
        };

        const companion = mockCompanions[id];

        if (!companion) {
          document.getElementById("companion-details").innerHTML = `
            <div class="p-8 text-center">
              <h2 class="text-2xl font-bold text-red-600 mb-3">找不到夥伴資料</h2>
              <p class="text-gray-600">無法找到ID為 ${id} 的夥伴資料，請返回夥伴列表重新選擇。</p>
            </div>
          `;
          return;
        }

        // 生成星級評分HTML
        const ratingStars = Array(5)
          .fill("")
          .map((_, i) => (i < Math.floor(companion.rating) ? "★" : i < companion.rating ? "★" : "☆"))
          .join("");

        // 生成評論HTML
        const reviewsHtml = companion.reviews
          .map(
            review => `
          <div class="border-b border-gray-200 pb-4">
            <div class="flex justify-between items-center mb-2">
              <span class="font-semibold">${review.name}</span>
              <span class="text-yellow-500">${"★".repeat(review.rating)}${"☆".repeat(5 - review.rating)}</span>
            </div>
            <p class="text-gray-600">${review.comment}</p>
          </div>
        `
          )
          .join("");

        // 生成可用日期HTML
        const availableDatesHtml = companion.availableDates
          .map(date => {
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString("zh-TW", { year: "numeric", month: "long", day: "numeric" });
            return `<span class="inline-block bg-green-100 text-green-800 rounded-full px-3 py-1 text-sm font-semibold mr-2 mb-2">${formattedDate}</span>`;
          })
          .join("");

        // 更新頁面內容
        document.getElementById("companion-details").innerHTML = `
          <div class="md:flex">
            <div class="md:w-1/3">
              <div class="h-96 bg-cover bg-center relative" style="background-image: url('${companion.imageUrl}')">
                <div class="absolute top-4 right-4 bg-white rounded-full px-3 py-1 text-sm font-semibold shadow-md">
                  <span class="text-yellow-500">${ratingStars}</span>
                  <span class="text-gray-700">(${companion.ratingCount})</span>
                </div>
                <div class="absolute top-4 left-4 bg-green-600 text-white rounded px-3 py-1 text-sm font-semibold shadow-md">
                  ${companion.type}
                </div>
              </div>
            </div>
            <div class="md:w-2/3 p-6">
              <h1 class="text-3xl font-bold mb-2">${companion.name}</h1>
              <div class="space-y-4 mb-6">
                <div class="flex items-center text-gray-700">
                  <span class="mr-2">🧭</span>
                  <span><strong>專長：</strong>${companion.specialty}</span>
                </div>
                <div class="flex items-center text-gray-700">
                  <span class="mr-2">📅</span>
                  <span><strong>經驗：</strong>${companion.experience}</span>
                </div>
                <div class="flex items-center text-gray-700">
                  <span class="mr-2">💬</span>
                  <span><strong>語言：</strong>${companion.languages}</span>
                </div>
                <div class="flex items-center text-gray-700">
                  <span class="mr-2">💰</span>
                  <span><strong>費用：</strong>每日 NT$${companion.price} 起</span>
                </div>
              </div>

              <div class="mb-6">
                <h2 class="text-xl font-semibold mb-2">關於我</h2>
                <p class="text-gray-600">${companion.bio}</p>
              </div>

              <div class="mb-6">
                <h2 class="text-xl font-semibold mb-2">可預約日期</h2>
                <div class="flex flex-wrap">
                  ${availableDatesHtml}
                </div>
              </div>

              <a href="#booking-section" class="block w-full bg-primary text-white text-center font-semibold py-3 rounded-lg hover:bg-primary-dark transition">
                立即預約
              </a>
            </div>
          </div>

          <!-- 評價區塊 -->
          <div class="p-6 border-t border-gray-200" id="reviews-section">
            <h2 class="text-2xl font-semibold mb-6">用戶評價</h2>
            <div class="space-y-4">
              ${reviewsHtml}
            </div>
          </div>

          <!-- 預約區塊 -->
          <div class="p-6 border-t border-gray-200" id="booking-section">
            <h2 class="text-2xl font-semibold mb-6">預約行程</h2>
            <form id="booking-form" class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="booking-date" class="block text-gray-700 mb-2">選擇日期</label>
                  <input
                    type="date"
                    id="booking-date"
                    class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
                    required
                  />
                </div>
                <div>
                  <label for="booking-duration" class="block text-gray-700 mb-2">行程時長</label>
                  <div class="flex items-center">
                    <input
                      type="number"
                      id="booking-duration"
                      min="1"
                      max="30"
                      value="1"
                      class="w-full border border-gray-300 rounded-l px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
                      required
                    />
                    <span class="bg-gray-100 border border-gray-300 border-l-0 rounded-r px-3 py-2 text-gray-700">天</span>
                  </div>
                </div>
                <div class="md:col-span-2">
                  <label for="booking-notes" class="block text-gray-700 mb-2">備註</label>
                  <textarea
                    id="booking-notes"
                    rows="4"
                    class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
                    placeholder="有特殊需求或問題嗎？請在此說明..."
                  ></textarea>
                </div>
              </div>

              <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 mb-2">
                  <span>每日費用</span>
                  <span>NT$${companion.price}</span>
                </div>
                <div class="flex justify-between items-center pb-2 border-b border-gray-200 mb-2">
                  <span>天數</span>
                  <span id="booking-days">1</span>
                </div>
                <div class="flex justify-between items-center font-semibold text-lg">
                  <span>總計</span>
                  <span id="booking-total">NT$${companion.price}</span>
                </div>
              </div>

              <button type="submit" class="w-full bg-primary text-white font-semibold py-3 rounded-lg hover:bg-primary-dark transition">
                確認預約
              </button>
            </form>
          </div>
        `;

        // 更新頁面標題
        document.title = `${companion.name} - 山伴`;

        // 設定預約表單相關事件
        const durationInput = document.getElementById("booking-duration");
        const bookingDaysSpan = document.getElementById("booking-days");
        const bookingTotalSpan = document.getElementById("booking-total");
        const bookingForm = document.getElementById("booking-form");

        if (durationInput && bookingDaysSpan && bookingTotalSpan) {
          durationInput.addEventListener("change", updateBookingTotal);
          durationInput.addEventListener("input", updateBookingTotal);

          function updateBookingTotal() {
            const days = parseInt(durationInput.value) || 1;
            const total = days * companion.price;
            bookingDaysSpan.textContent = days;
            bookingTotalSpan.textContent = `NT$${total}`;
          }
        }

        if (bookingForm) {
          bookingForm.addEventListener("submit", function (e) {
            e.preventDefault();

            const bookingDate = document.getElementById("booking-date").value;
            const bookingDuration = document.getElementById("booking-duration").value;
            const bookingNotes = document.getElementById("booking-notes").value;

            // 在實際應用中，這裡應該將預約資料發送到服務器
            console.log("預約資料:", {
              companionId: companion.id,
              date: bookingDate,
              duration: bookingDuration,
              notes: bookingNotes,
            });

            // 模擬成功預約
            alert(`已成功預約 ${companion.name} 的服務！\n日期: ${bookingDate}\n天數: ${bookingDuration}天\n總費用: NT$${companion.price * bookingDuration}`);
          });
        }
      }
    </script>
  </body>
</html>
